---
title: "Mini-Project 2"
author: "Your Name Here"
date: "October 31, 2017"
output: html_document
---

```{r}
```


## Loading the data

This project is so interesting and relevant to my life! yayy 

```{r, include=FALSE}

load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)

```


put tables in a useable format
```{r, warning = FALSE, include = FALSE}

#filtered house_elections
house_filtered <- house_elections %>%
  select(fec_id, general_votes, ge_winner)
house_filtered

#filtered candidates
candidates_filtered <- candidates %>% 
   select(-c(cand_st1, cand_st2, cand_city, cand_state,cand_zip))
candidates_filtered

#filtered contributions
contributions_filtered <- contributions %>% 
  select(cmte_id, name, city, state, zip_code, transaction_dt, transaction_amt, cand_id, other_id)
contributions_filtered

 #filter committees 
committees_filtered <- committees %>% 
  select(cmte_id, cmte_name, cmte_city, cmte_state, cmte_zip, cmte_party_affiliation, cand_id)
committees_filtered
```

merge the nice tables
```{r, warning = FALSE, include = FALSE}

house_filtered2 <- house_filtered %>%
  rename(cand_id = fec_id)

house_filtered2

joined_table <- 
  left_join(candidates_filtered, house_filtered2, by = "cand_id")
complete_table <- left_join(joined_table, contributions_filtered, by = "cand_id")

complete_table
```

```{r}
#lubridate
require(lubridate)

dates <- complete_table %>% 
  mutate(date = mdy(transaction_dt))
glimpse(dates)




```

view the new table
```{r}
# sorting the complete table

presum_races <- dates %>%
  filter(cand_election_yr == "2012", cand_office == "S")%>%  
  group_by(cand_name, transaction_dt) %>%
  mutate(total = sum(transaction_amt))

by_month <- presum_races %>% 
  mutate(month = format(date, "%m"), year = format(date, "%Y")) %>%
  group_by(month,year)%>%
  mutate(monthly_contr = sum(transaction_amt))%>%
  mutate( bymonth = paste(c(month,year)))%>% 
  mutate( month_year = as.Date(bymonth, format = "%m.%Y"))
  
by_month
  
```
```{r}
#in class portion
plot <- function (x) {
  by_month <- by_month %>%
    filter(cand_office_state == x) 
  by_month

   find_total <- by_month %>% 
      group_by(cand_id)%>%
      summarise(totalz = sum(abs(transaction_amt)))%>%
      arrange(desc(totalz)) %>%
      mutate( id = row_number())%>% 
      filter(id <= 3)
   find_total
top3table <- left_join(graph_by_month, find_total, by = "cand_id")
glimpse(top3table)
  
candidate1 <- top3table %>% 
  filter(id == 1) 
candidate2 <- top3table %>%
  filter(id == 2)
candidate3 <- top3table %>% 
  filter(id == 3)

plotz <- 
  ggplot(top3table, aes(x = date, y = monthly_contr)) +  
  geom_col(data = candidate1, aes(x = date, y = monthly_contr), inherit.aes = FALSE) +
  geom_col(data = candidate2, aes(x = date, y = monthly_contr, color = id), inherit.aes = FALSE) 
plotz  
}

plot("CA")


```

```{r}
 by_month <- by_month %>%
    filter(cand_office_state == "CA") 
  by_month

   find_total <- by_month %>% 
      group_by(cand_id)%>%
      summarise(totalz = sum(abs(transaction_amt)))%>%
      arrange(desc(totalz)) %>%
      mutate( id = row_number())%>% 
      filter(id <= 3)
   find_total
top3table <- left_join(by_month, find_total, by = "cand_id")
top3table
  
candidate1 <- top3table %>% 
  filter(id == 1) 
candidate2 <- top3table %>%
  filter(id == 2)
candidate3 <- top3table %>% 
  filter(id == 3)

plotz <- 
  ggplot(top3table, aes(x = month(), y = monthly_contr)) +  
  geom_col(data = candidate1, aes(x = month, y = monthly_contr), inherit.aes = FALSE) +
  geom_col(data = candidate2, aes(x = month, y = monthly_contr, color = id), inherit.aes = FALSE) 
plotz 
```

